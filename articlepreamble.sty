\NeedsTeXFormat{LaTeX2e}
\ProvidesPackage{articlepreamble}

% Fonts
\RequirePackage{fontspec}
\defaultfontfeatures{Ligatures=TeX}

% Localization
\RequirePackage[english]{babel}

% Text highlighting
\RequirePackage{soul}

% Nomenclature
\RequirePackage{nomencl}
\makenomenclature
\renewcommand{\nomname}{\makebox[\linewidth]{Nomenclature}}

% Math
\RequirePackage{amsmath,amssymb,bm,upgreek}

% Missing commands
\providecommand{\abs}[1]{\left\lvert#1\right\rvert}                       % |.|
\providecommand{\br}[1]{\left(#1\right)}                                  % (.)
\providecommand{\sbr}[1]{\left[#1\right]}                                 % [.]
\providecommand{\ddfrac}[2]{\frac{\displaystyle #1}{\displaystyle #2}}    % ./.
\newcommand\AR{\text{\itshape\clipbox{0pt 0pt .32em 0pt}\AE\kern-.30emR}} % AR (Aspect ratio)
% \newcommand\AR{\clipbox{0pt 0pt .32em 0pt}\AE\kern-.30emR}              % AR (Aspect ratio)
\newcommand\na{{---}}                                                     % N/A
\newcommand*\conj[1]{{#1}^*}                                              % Conjugate
\newcommand*\mean[1]{\bar{#1}}                                            % Mean

% Missing environments
\newenvironment{wrappedfigure}[1]
{
  \vspace{\baselineskip}
  \noindent
  \begin{minipage}{#1}
  \captionsetup{type=figure}
}
{
  \end{minipage}
  \vspace{\baselineskip}
  \noindent
}

\newenvironment{wrappedtable}[1]
{
  \vspace{\baselineskip}
  \noindent
  \begin{minipage}{#1}
  \captionsetup{type=table}
}
{
  \end{minipage}
  \vspace{\baselineskip}
  \noindent
}

% \renewenvironment{abstract}
% {
%   \small
%   \begin{center}
%     \bfseries \abstractname\vspace{-.5em}\vspace{0pt}
%   \end{center}
% }{}

% Units
\RequirePackage{siunitx}

% Missing units
\DeclareSIUnit\strain{\hspace{0em}}                          % Strain
\NewDocumentCommand{\angsi}{omom}{\ang[#1]{#2}\,\si[#3]{#4}} % Redefined \ang with optional unit

% Listings
\RequirePackage{listings}

% Options for listings
\lstset{
  breaklines=true,
  postbreak=\raisebox{0ex}[0ex][0ex]{\ensuremath{\color{red}\hookrightarrow\space}},
  numbers=left,
  numbersep=5pt,
  numberstyle=\tiny\color{gray},
  basicstyle=\footnotesize\ttfamily
}

% Title formatting
\RequirePackage{titling}
\predate{}
\postdate{}

% Tables
\RequirePackage{booktabs,multirow,array,tabularx}

% Multi-columns
\RequirePackage{multicol}

% Captions
\RequirePackage{caption,subcaption}

% Lists
\RequirePackage{enumitem}

% Graphics
\RequirePackage{tikz,graphicx}

% Geometry
\RequirePackage[letterpaper,left=0.5in,right=0.5in,top=0.5in,bottom=1in]{geometry}

% Color
\RequirePackage{xcolor}
\definecolor{gray}{HTML}{616161}
\definecolor{gray-dark}{HTML}{373737}
\definecolor{gray-light}{HTML}{fafafa}
\definecolor{orange-dark}{HTML}{ff7043}
\definecolor{orange-light}{HTML}{fbe9e7}
\definecolor{green-dark}{HTML}{66bb6a}
\definecolor{green-light}{HTML}{e8f5e9}
\definecolor{blue-dark}{HTML}{29b6f6}
\definecolor{blue-light}{HTML}{73e8ff}
\definecolor{red-dark}{HTML}{e57373}
\definecolor{red-light}{HTML}{ffa4a2}
\definecolor{purple-dark}{HTML}{ba68c8}
\definecolor{purple-light}{HTML}{ee98fb}

% References and citations
\RequirePackage[colorlinks=true,allcolors=blue-dark]{hyperref}
\RequirePackage{cleveref}

% Bibliography
\RequirePackage[backend=biber,style=numeric,citestyle=numeric-comp,sorting=none,doi=false,isbn=false,url=false,eprint=false]{biblatex}

% Abstract keywords
\providecommand{\keywords}[1]{\noindent{\textbf{Keywords:}} #1}

% Draft option
\newif\if@loaddraft\@loaddraftfalse
\DeclareOption{draft}{\@loaddrafttrue}
\ProcessOptions\relax

\if@loaddraft
  \RequirePackage[firstpage]{draftwatermark}
\fi
